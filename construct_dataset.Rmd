---
title: "Dataset Creation"
author: "Melvin Coleman"
date: "12/2/2022"
output: github_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(readr)
library(rvest)
library(httr)

```

Let's create the dataset we will utilize for the final project. Data was pulled 
from the web via scarping and downloaded from websites. The "data" folder 
contains the csv files of data downloaded and intended for use. 

### World Cup Records & Statistics 
This data was loaded data from Wikipedia and contains record and statistics of
the overall team records of the FIFA World Cup.

```{r}
wiki_list =
records_stats_html = read_html("https://en.wikipedia.org/wiki/FIFA_World_Cup_records_and_statistics") %>% 
  html_table(header = TRUE)

wc_stats =
  wiki_list[[2]]
  
wc_stats = 
  wc_stats %>% 
  janitor::clean_names() %>%
   rename(country = team) %>% 
  ## Delete rank(data ranked in order of WC winners) & team
  select(country, everything(), -rank) %>% 
  
  ## Clean dataset, remove weird characters in names 
  mutate(
     country = str_replace(country, "//[c]", "")
  ) %>%
  apply(., 2, function(country) as.character(gsub("\\[|a\\]","",country))) %>%
  apply(., 2, function(country) as.character(gsub("\\[|b\\]","",country))) %>%
  apply(., 2, function(country) as.character(gsub("\\[|c\\]","",country))) %>%
  apply(., 2, function(country) as.character(gsub("\\[|d\\]","",country))) %>%
  apply(., 2, function(country) as.character(gsub("\\[|e\\]","",country))) %>%
  apply(., 2, function(country) as.character(gsub("\\[|f\\]","",country))) %>%
  as_tibble()
  
wc_stats
```


### Fifa Ranking [Fifa Rankings](https://www.2026worldcupnorthamerica.com/fifa-ranking/)

This dataset was created via web scraping. 
```{r}
wc_rank_html =
   read_html("https://www.2026worldcupnorthamerica.com/fifa-ranking/") 

rank_text = 
  wc_rank_html %>% 
  html_elements(".grippy-host , td:nth-child(1), td:nth-child(1)") %>% 
  html_text() 

rank_text

country_text =
  wc_rank_html %>% 
  html_elements("td:nth-child(2)") %>% 
  html_text() 
  
country_text

fifa_rankings = 
tibble(
  rank = rank_text,
  country = country_text
) 

fifa_rankings

```

### Confederations Dataset

This dataset was downloaded as a csv file and limited to variables of interest.

```{r}
confederations_data = 
  read_csv(file = "data/fifa_countries_audience.csv", col_names = TRUE) %>% 
  janitor::clean_names() %>% 
  select(country, confederation)## Select variables of interest 

```

### Top goal scorers per country 

This dataset was pulled from Wikipedia via web scraping. 
```{r}
goals_text_html =
   read_html("https://en.wikipedia.org/wiki/List_of_top_international_men%27s_football_goal_scorers_by_country")  %>% 
  html_table(header = TRUE)

goals_country_df = 
  goals_text_html[[1]]


goals_country_df =
  goals_country_df %>% 
  janitor::clean_names() %>% 
  select(country, player, goals)  %>% 
  
## There are countries with more than one goal scorer, let's fix this
  aggregate(player ~ country, FUN = paste, collapse = ' & ') %>% 
  arrange(country)
    
## Countries to worry about:
## Anguilla, Bulgaria, CuraÃ§ao, Denmark,Eritrea, Eswatini, Faroe Islands, France,
## Gibraltar, Iceland, Lebanon, Lesotho, Mongolia, Namibia, Palestine,Romania,
## Scotland, U.S. Virgin Islands, United States

goals_country_df
```

### Population Data 2021 Population 

```{r}
pop_df = 
read_csv(file = "data/pop.csv", col_names = TRUE) %>% 
  janitor::clean_names() %>% 
  select(country, area, land_area_km)

```

Now let's combine all of our datasets to create our final dataset. 

The datasets we have currently are: <br> 
- wc_stats (contains world cup statistics & records)
- fifa_rankings (official Fifa rankings 2022)
- goals_country_df (top goal scorers per country)
- pop_df(land area of countries)
- confederations_data(what confederations each country is in)

We will combine these datasets by the `country` variable and Removed land and area
```{r}
### Put all dataframes into a list & merge by country

dfs = list(fifa_rankings, goals_country_df, pop_df,confederations_data)

df_2 =
  dfs %>%
  reduce(full_join, by= "country")
 
final_dataset_2 = 
  left_join(wc_stats,df_2, by= "country")%>%
  select(-land_area_km,-area)


```

Download in order to manually edit NA for confederation 

```{r}
write.csv(final_dataset_2, "final_dataset.csv")
```

# Downloaded edited cvs

```{r}
world_cup_dataset = 
  read_csv(file = "./data/final_dataset.csv", col_names = TRUE)
  
```

#saved into file
```{r}
write.csv(world_cup_dataset, "world_cup_dataset.csv")

```
  
# Below ways that I tried to change the name of the conderation by code 
  
final_dataset[is.na(final_dataset)] = "Something"

mutate(confederation = ifelse(confederation == "NA", "UEFA"))

- big problem is it can make a change in the cell but it will be the same for each of the NA 
- we want different for each cell
- also tried doing "if_else" and it wasn't successful

- unfortunately there are missing for alot of different variable still 
- if we can get the code to work it will make it very easy to make the changes

Also to keep track this is missing data for both confederation and land area km are:<br>  

- England UEFA (can't find for england alone in km)
- East Germany 108330 UEFA
- Scotland 77910 UEFA

- Republic of Ireland UEFA 70273
- Northern Ireland UEFA 14130
- Wales UEFA 20780
- Senegal, CAF
- Spain, UEFA

Just confederation missing: 
- Bosnia and Herzegovina, UEFA
- Trinidad and Tobago, CONCACAF
- United Arab Emirates, AFC

**I found majority of land area km so we could actually use that one, only one missing is England **

